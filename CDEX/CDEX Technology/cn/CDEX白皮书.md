# CDEX 协议， polkadot 上的开放的去中心化交易所协议

## 摘要

CDEX 协议是基于 polkadot 的去中心化交易协议，任何人可以基于 CDEX 协议搭建属于自己的去中心化交易所。CDEX 协议具有去中心化交易所的基本特性，实现了链下订单中继、去中心化资产托管。此外，CDEX 协议还实现了基于委托的链下资产结算机制和订单的链上撮合功能， 基于 polkadot 的异构平行链架构，CDEX 实现了平行链间的资产跨链交换，为基于 CDEX 协议的交易所带来更好的体验。

## 背景

传统互联网是传递信息的网络，信息都保存在中心化的机构中，由于缺乏可靠的信任机制，陌生节点间无法完成大规模的价值交换。互联网的发展趋势必然是从信息互联网最终过渡到价值互联网。比特币的出现使得可信的价值转移成为了可能，带动了区块链技术的蓬勃发展。一大批区块链项目发行了自己的代币及公链。种类繁多的代币对于交换提出了强劲的需求，带动了去中心化 Token 互换协议的研究，陆陆续续涌现了 Etherdelta、 0x、IDEX 等基于以太坊去中心化交易协议。

然而 Etherdelta, IDEX 等由链上进行订单处理，结算等协议受限于以太坊的性能，导致用户体验很差，同时每个动作都需要消耗 gas，并且需要等待区块链的确认，极大影响了去中心化交易所的使用。为了解决该问题，0x 协议提出了链下处理订单、链上进行结算，通过把交易订单在链下让中继 relayer 撮合处理，然后再区块链上进行结算确认。这样结合两者之优势，在提升了交易速度的同时，又保证了安全性。

同时我们看到以 0x 协议为代表的价值交换协议却只能用于 ERC-20(ERC-721)代币，众多用于自己主网的代币例如 BTC, EOS, NEO 等无法通过去中心化协议进行交换、目前区块链间呈现出来的这种问题被称作“孤岛效应”，这种孤岛的限状极大影响了去中心化交易所的发展，生态无法对接，体系难以增长。想要形成一个真正的价值互联网，使得不同代币自由流转，就必须链与链之间价值流通的障碍。

polkadot 由以太坊联合创始人 Gavin Wood 创建，是一个旨在解决区块链间交互性的跨链项目。Polkadaot 独特的跨链机制旨在将当下各自独立的区块链网络串联起来，让不同链间可以进行通信和数据传递。

CDEX 是构建与 polkadot 之上的去中心化交易协议，依托于 polkadot 跨链机制，CDEX 将构建更大规模，公平、去中心的点对点数字交易，极大拓展去中心化交易所的使用范围。

### CDEX 介绍

CDEX 协议的架构包含三部分。
Relayer 是订单中继系统，与 CDEX 智能合约交互，主要负责订单撮合与提交上链。Relayer 对外提供 OpenApi. 允许第三方交易所提交订单到撮引擎。
第三方交易所的职责是收集用户提交的订单数据，并将签名的订单提交给 Relayer。 通过 CDEX 协议，不同交易所可以成为分布式商业系统的一部分，共享订单数据和流动性，为用户带来更好的交易深度和体验。

### 订单交易

#### 交易流程

1. 协议授权。需要交易代币的用户 Alice 先对 CDEX 智能合约进行授权，使得 CDEX 合约能够获取代币 A 的余额。
2. 创建订单。Alice 创建代币 A 替换代币 B 的订单，指定所需的汇率，到期时间，并使用其私钥对该订单进行签名。
3. 广播订单。Alice 通过任意渠道进行广播订单。
4. 订单接收。Bob 接收到订单，并决定他们想填单。
5. 订单交换。Bob 同意 Dex 合约访问代币 B 的余额，并提交签名的订单到 Dex 合约，Dex 合约认同 maker 的签名，验证订单没有到期，然后以指定汇率转让双方之间的代币。

#### Relayer 撮合

CDEX 的技术实现中，引入了 Ox 协议的 Relayer。Relayer 是任何实现了 CDEX 协议和提供了链下订单簿服务的做市商、交易所、Dapp 等等。Relayer 的订单簿技术实现可以是中心化的也可以是非中心化的。Relayer 从成交交易中收取手续费获利。交易过程大略如下：

1. Relayer 设置自身的交易服务费用规则，并对外提供订单簿服务。
2. Maker 选定一个 Relayer 进行挂单创建和填充必要的订单，手续费信息，并用私钥签名。
3. Maker 将签名后的订单提交给 Relayer.
4. Relayer 对订单做必要的检查，并将其更新到自身的订单簿。
5. Takers 监看到订单簿的更新，并选中成交订单。
6. Takers 对选中的订单进行填充，并广播至区块链完成最后的成交。
