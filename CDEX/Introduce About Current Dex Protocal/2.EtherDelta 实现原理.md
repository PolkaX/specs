[EtherDelta](https://etherdelta.com/) 是基于以太坊的以太币与ERC20代币互换的开源去中心交易平台（智能合约[github](https://github.com/etherdelta/smart_contract)地址）。

![image-20190925144743160](/Users/qinghuan/Library/Application Support/typora-user-images/image-20190925144743160.png)

### 技术概览

它主要由两部分组成，一个是EtherDelta网站，另一个是etherdelta智能合约。

EtherDelta网站是提供给用户操作的界面接口。用户可以在网站上充值，体现，挂单交易。

etherdelta智能合约是部署于以太坊上的特定版本地址智能合约。合约中主要实现了用户资产托管登记簿和订单簿。订单簿中以代币为维度维护了所有当前所有成交挂单和未成交挂单。用户资产登记簿主要是维护了用户的代币资产和支持成交挂单的资产清算。

由于EtherDelta是交易驱动的模式，所以用户的所有操作都需要普通的以太坊交易来触发。因此，用户需要依赖以太坊钱包工具来执行交易指令，譬如MetaMask钱包。一个正常的流程可能是这样的：

1. 充值。用户通过钱包工具向以太坊etherdelta合约发起充值函数调用。该交易会将代币资产转账至合约，etherdelta合约会对该笔转让资产进行接收和登记托管于资产簿中。
2. 挂单交易。用户在网站挂单列表中相中一笔挂单符合成交预期，则在网站上取得该挂单相关信息，组成交易指令，并通过钱包工具对交易指令进行签名，并通过网站向以太坊网络广播。以太坊etherdelta合约执行交易指令，对相关代币比例进行计算和交易费用计算，如果订单正常成交，则会进行买卖双方的订单清算，并更新到用户资产登记薄中。
3. 提现。用户通过钱包工具向以太坊etherdelta合约发起提现函数调用。该交易会将代币资产从合约转账至用户个人账户地址，etherdelta合约会对该笔转让资产更新至资产簿中。

如果用户挂单需要取消，则和挂单交易一样的步骤，需要通过钱包工具组装取消交易指令来调用etherdelta合约更新其上的订单簿。这种情况下，对于没有成交的挂单，则发出了两次以太坊交易，浪费了交易费用。因此这里有个简单的优化，既是在EtherDelta网站存在一个链下订单簿缓存服务，对于并未成交的订单缓存于链下，只有真正成交了才将交易广播到以太坊网络中，如果没有成交，就可以随时在链下无成本取消。

另外需要注意的是，对一个以太坊账户而言，它所发出的交易的顺序递增特性是很重要的 ，它必须是顺序增长。因此，这个特性对EtherDelta的操作来说特别重要，一旦乱序，交易指令就会无法正常执行。

EtherDelta技术实现的核心主要有两点，其一是智能合约的资产托管，它保障了去中心化去信任化的资产安全交易，用户资产只会在用户私有账户和托管合约中转移，并且只能由用户自己发起。然而安全也不是绝对的，由于用户侧安全操作方面依然有可能给攻击者提供机会([去中心化交易所以德(EtherDelta)被盗--我们如何从中吸取教训](https://mp.weixin.qq.com/s?__biz=MzI5OTc2NjA3MQ==&mid=2247483770&idx=1&sn=4cd0a09a76b008477234c4ed5c704a12&key=2bcf5ce5a13cfb5f23eed3714c55959a423367281bc7a5485327781320c3064d43aa4f130a1c346aa91c2c547e9b18dc344fee3ff6bc43db587d30a7ec91f50c8e95ff4e71c30cc301d3286681e1154f&ascene=0&uin=MjM0MDg0MjE1&devicetype=iMac+MacBookAir7%2C2+OSX+OSX+10.11.3+build(15D21)&version=11020201&pass_ticket=axNVU7JcGqcSIhfKWgQ2xxSGT3V%2FxaWMJ6a5TY4b5tQ%3D)。其二是交易驱动的模式，对普通用户而言，有较高的操作门槛。任何的资产操作和交易操作都是通过以太坊交易来驱动，也因此导致了交易速度慢，交易深度不够，交易费用高，交易列表更新不及时，交易序号无效，交易重复，交易不能合并成交等等很多广泛被用户诟病的问题。

尽管有各种各样的问题，EtherDelta模式简单清晰，起步较早，上线一年多，随着以太坊生态的发展和用户教育的进步也积累了一定量的用户和可观的成交量。它是以太坊上去中心化交易所的先行者，对后来者有一定的启发作用。后来者大多都借鉴认可EtherDelta的智能合约资产托管设计，并试图在成本和体验两个要素上做进一步的优化设计。

